{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://atlas-local.dev/schemas/atlas-events-jsonl-v1.0.0.json",
  "title": "Atlas Events JSONL v1.0.0",
  "description": "Schema for each line in Atlas Events JSONL output. Each line is an independent JSON object representing a scan lifecycle event.",
  "type": "object",
  "required": ["schema_version", "event_type", "timestamp", "correlation_id"],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0"
    },
    "event_type": {
      "type": "string",
      "enum": [
        "scan_started",
        "scan_completed",
        "file_analyzed",
        "finding_detected",
        "gate_evaluated",
        "error_occurred",
        "cache_hit",
        "cache_miss",
        "rulepack_loaded",
        "policy_loaded",
        "baseline_loaded"
      ],
      "description": "Type of event."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 event timestamp."
    },
    "correlation_id": {
      "type": "string",
      "description": "Scan-scoped correlation ID for grouping related events."
    },
    "data": {
      "type": "object",
      "description": "Event-specific payload. Structure varies by event_type.",
      "properties": {
        "scan_id": { "type": "string" },
        "engine_version": { "type": "string" },
        "target_path": { "type": "string" },
        "file_path": { "type": "string" },
        "language": { "type": "string" },
        "finding": {
          "type": "object",
          "description": "Finding summary (for finding_detected events).",
          "properties": {
            "fingerprint": { "type": "string" },
            "rule_id": { "type": "string" },
            "severity": { "type": "string" },
            "category": { "type": "string" },
            "file_path": { "type": "string" },
            "line": { "type": "integer" }
          }
        },
        "gate_result": { "type": "string", "enum": ["PASS", "FAIL", "WARN"] },
        "duration_ms": { "type": "integer" },
        "files_scanned": { "type": "integer" },
        "findings_count": { "type": "integer" },
        "error_message": { "type": "string" },
        "error_code": { "type": "string" }
      }
    }
  }
}
