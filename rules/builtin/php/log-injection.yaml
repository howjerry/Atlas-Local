id: atlas/security/php/log-injection
name: Log Injection via Unsanitized User Input
description: >
  Detects usage of error_log() or syslog() with string interpolation or
  concatenation that may include user-controlled variables. An attacker
  can inject newline characters to forge log entries or exploit log
  processing systems.
severity: medium
category: security
language: Php
cwe_id: CWE-117
pattern: |
  [
    ((function_call_expression
      function: (name) @func_name
      arguments: (arguments
        (argument
          [(encapsed_string) (binary_expression)] @log_msg)))
      (#match? @func_name "^(error_log|syslog)$"))
    @match
  ]
remediation: >
  Sanitize user input before including in log messages. Strip newline and
  carriage return characters. Use structured logging with Monolog or
  similar libraries that automatically encode log data. Example:
  `error_log('User login: ' . str_replace(["\n", "\r"], '', $username))`
references:
  - https://cwe.mitre.org/data/definitions/117.html
  - https://cheatsheetseries.owasp.org/cheatsheets/Logging_Cheat_Sheet.html
tags:
  - log-injection
  - logging
  - owasp-top-10
  - a09-security-logging-failures
metadata:
  compliance:
    - framework: owasp-top-10-2021
      requirement: "A09:2021"
      description: Security Logging and Monitoring Failures
version: 1.0.0

