id: atlas/security/go/log-injection
name: Log Injection via Unsanitized User Input
description: >
  Detects usage of fmt.Printf, fmt.Sprintf, log.Printf and similar
  formatting functions where user-controlled variables are embedded via
  format strings. An attacker can inject newline characters or log
  formatting sequences to forge log entries, hide malicious activity,
  or exploit downstream log processing systems (SIEM, ELK).
severity: medium
category: security
language: Go
cwe_id: CWE-117
pattern: |
  [
    (call_expression
      function: (selector_expression
        operand: (identifier) @pkg
        field: (field_identifier) @func
        (#eq? @pkg "log")
        (#match? @func "^(Printf|Fatalf|Panicf)$"))
      arguments: (argument_list
        (interpreted_string_literal)
        (identifier) @user_input))
    @match

    (call_expression
      function: (selector_expression
        operand: (identifier) @pkg
        field: (field_identifier) @func
        (#eq? @pkg "fmt")
        (#match? @func "^(Printf|Fprintf|Sprintf)$"))
      arguments: (argument_list
        (interpreted_string_literal)
        (identifier) @user_input))
    @match
  ]
remediation: >
  Sanitize user input before including it in log messages. Strip or encode
  newline characters (\n, \r), carriage returns, and other control characters.
  Use structured logging libraries like zerolog or zap that automatically
  handle input encoding. Example: `log.Info().Str("user", sanitize(input)).Msg("login")`
references:
  - https://cwe.mitre.org/data/definitions/117.html
  - https://cheatsheetseries.owasp.org/cheatsheets/Logging_Cheat_Sheet.html
tags:
  - log-injection
  - logging
  - owasp-top-10
  - a09-security-logging-failures
metadata:
  compliance:
    - framework: owasp-top-10-2021
      requirement: "A09:2021"
      description: Security Logging and Monitoring Failures
version: 1.0.0

